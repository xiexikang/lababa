**目标**

* 将 `pages/statistics/index.vue` 的所有统计与列表切换为“仅个人”接口数据；接入评分与明细展示；保持现有UI风格。

**接口对接与数据结构**

* 周概览：`GET /api/statistics/week`

  * 返回：`{ daysCount:number, recordsCount:number, colorDist:Record<string,number>, score:number, scoreDetails:Array<{label:string,value:number}> }`

  * 绑定：`week.daysCount`、`week.recordsCount`、`week.colorDist`、`week.score`、`week.scoreDetails`

* 月日历：`GET /api/statistics/month-days`

  * 返回：`{ days:string[], dayStatusMap:Record<string,{normal:number,diarrhea:number,constipation:number}> }`

  * 绑定：`month.days`（用于 `monthMarkDays`）、`month.dayStatusMap`（用于 `statusForDay(day)`）

* 最近记录：`GET /api/record/recent?limit=10`

  * 返回：`{ list:Array<{ id,startTime,endTime,duration,color,status,shape,amount,note? }> }`

  * 绑定：`recent.list`

* 详情弹窗：`GET /api/record/:id`

  * 保持现有弹窗结构，打开时按 id 拉取详情

**前端实现步骤**

1. 新增响应式容器（setup 顶部）：

   * `const week = reactive({ daysCount:0, recordsCount:0, colorDist:{}, score:0, scoreDetails:[] })`

   * `const month = reactive({ days:[], dayStatusMap:{} })`

   * `const recent = reactive({ list:[] })`
2. 并发拉取（onMounted）：

   * 若无 `auth-token`：`showModal` 引导至 `/pages/profile/index` 授权；授权后返回该页自动刷新

   * 并发：

     * `const w = await get('/api/statistics/week')`

     * `const m = await get('/api/statistics/month-days')`

     * `const r = await get('/api/record/recent',{ limit:10 })`

   * 赋值到 `week/month/recent`
3. 替换现有 computed 引用（具体文件位置）：

   * `pages/statistics/index.vue:326` 替换 `weeklyDaysCount` 为 `computed(() => week.daysCount)`

   * `pages/statistics/index.vue:246–247` 替换 `weeklyRecordsCount` 为 `computed(() => week.recordsCount)`

   * `pages/statistics/index.vue:257–264` 替换 `weeklyColorDist` 为 `computed(() => week.colorDist)`

   * `pages/statistics/index.vue:266–275` 替换 `weeklyScore` 为 `computed(() => week.score)`

   * 最近记录：`pages/statistics/index.vue:149` 用 `computed(() => recent.list)`

   * 日历：`pages/statistics/index.vue:171–191` 去除从 `store.globalState.records` 聚合，改为：

     * `monthMarkDays = computed(() => month.days)`

     * `statusForDay(day)` 从 `month.dayStatusMap[d]` 取 `normal/diarrhea/constipation` 返回 `success/warning/danger`
4. 评分明细展示：

   * 在评分条旁新增明细渲染（如同 `section-subtitle` 下一行）：遍历 `week.scoreDetails` 输出 `label` 与 `value`（带 +/−号）

   * 色条阶梯色保留现有样式：`>=80` 绿、`60–79` 黄、`<60` 红；可通过 `score` 改变 `score-fill` 背景渐变或类名
5. 详情弹窗（保持现状）：

   * 打开时校验 token → `GET /api/record/:id` → 成功填充 `detail` 并 `detailVisible=true`；失败 toast

**错误与空状态**

* 接口失败：toast 错误并保持空状态提示；允许手动重试（可在“最近记录”区添加重试按钮）

* 无记录：显示“还没有记录哦～快去主页打卡吧！”（保留现有 `.empty-state`）

**鉴权说明**

* 统一请求层已启用：默认需鉴权；公开接口 `/api/auth/**` 不鉴权

* 统计页接口均按 token 返回个人数据，前端无需传 `userId`

**验证**

* 未登录 → 授权提示；登录后数据展示

* 三类样本分数合理：全正常（≥80）、混合（60–80）、异常（≤55）

* H5 与小程序显示一致；日历状态点与最近记录均为个人数据

**后续可配置（可选）**

* 抽出评分权重到配置；在个人中心提供“评分规则”页面，允许

