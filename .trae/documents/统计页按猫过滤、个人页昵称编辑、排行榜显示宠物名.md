## 概述
- 目标：
  - 统计页所有数据按“当前选择的猫”过滤并与后端接口一致。
  - 个人页支持修改昵称，信息卡右侧加可点击小三角入口。
  - 排行榜显示用户的宠物名称（非仅本人），并与后端数据对齐。
- 相关现状：
  - 统计页已在部分调用传递`catId`，但存在接口名/数据结构不匹配与未按猫加载的个别点。
  - 个人页无昵称编辑UI，但后端已提供`PUT /api/users/update/:id`。
  - 排行榜前端仅对“我”显示昵称，后端`/api/ranking/list`不返回昵称/猫名。

## 统计页调整（src/pages/statistics/index.vue）
- 接口对齐与按猫过滤：
  - 最近记录与摘要：保留并确保传`catId`（当前已传）。
    - 代码：`/api/records/list` g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:331；`/api/statistics/summary` g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:341
  - 月度按天：保留并传`catId`；同时将后端返回的`days`数组转换为`dayStatusMap`供日历打点使用。
    - 代码：调用 g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:566；打点读取 g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:399-410
  - 体重：
    - 列表：保留`GET /api/cats/weights/list`（已对齐）。代码 g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:618
    - 新增：将`GET /api/weights/add`改为`POST /api/cats/weights/create`，body含`catId、weightKg、date`。代码 g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:635
  - 提醒设置：改为使用猫设置接口
    - 读取：`GET /api/cats/settings/get?catId=` 预填`remindEnabled、remindNoRecord、remindDiarrhea、quietStart、quietEnd`
    - 保存：`PUT /api/cats/settings/update/:catId`，body传以上设置
    - 代码：弹窗与保存 g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:200-249、652
  - 订阅模板：`GET /api/reminders/templates`后将返回的`tmplIds`传给`Taro.requestSubscribeMessage`
    - 代码：g:\www-xxk\xcx-lababa\src\pages\statistics\index.vue:659-671
- 后端支持确认（server-go/main.go）：
  - `GET /api/records/list`与`GET /api/statistics/summary`均支持`catId`过滤（lines 502、726）
  - `GET /api/statistics/month-days`支持`catId`（line 763）
  - 体重：`GET /api/cats/weights/list`（line 1306）、`POST /api/cats/weights/create`（line 1337）
  - 猫提醒设置：`GET /api/cats/settings/get`（line 1385）、`PUT /api/cats/settings/update/:catId`（line 1408）
  - 订阅模板：`GET /api/reminders/templates`（line 1511）

## 个人页昵称编辑（src/pages/profile/index.vue）
- UI改造：
  - 在用户信息卡右侧增加一个小三角图标，点击打开“编辑昵称”弹窗（一个`nut-popup`+`nut-input`/小程序`input`）。
  - 显示位置：`user-info`卡（当前昵称显示位置 g:\www-xxk\xcx-lababa\src\pages\profile\index.vue:12）；点击入口绑定`openEditNickname`。
- 交互逻辑：
  - 读取用户ID：从`Taro.getStorageSync('user-info')`的`id`。
  - 保存：调用`PUT /api/users/update/:id`，body `{ nickName }`；成功后更新本地缓存并触发`Taro.eventCenter.trigger('user-updated', ...)`。
  - 失败提示与鉴权沿用`utils/request.ts`默认行为。
- 代码位置参考：
  - 授权逻辑与本地存储：g:\www-xxk\xcx-lababa\src\pages\profile\index.vue:167-222、148-154
  - 后端接口：server-go/main.go:479-500

## 排行榜显示宠物名（src/pages/ranking/index.vue + server-go）
- 后端改造（server-go/main.go）：
  - 扩展`GET /api/ranking/list`返回`nickname`与`catName`：
    - `nickname`：联表`users`读取昵称。
    - `catName`：按请求周期在`records`中按`userId、catId`分组计数，选择该用户计数最高的`catId`并联表`cats.name`。
    - 保持分页与`period`逻辑不变（lines 811-880）。
- 前端改造（src/pages/ranking/index.vue）：
  - 列表项显示宠物名称（优先使用后端`catName`）。将当前的昵称展示（g:\www-xxk\xcx-lababa\src\pages\ranking\index.vue:50）替换为“宠物名”，若无则显示“未命名”。
  - `updateRanking`与`loadMore`映射使用后端返回的`catName`、`nickname`，不再仅对本人填充昵称（g:\www-xxk\xcx-lababa\src\pages\ranking\index.vue:190-202、227-236）。
  - “我的当前猫次数”计算逻辑保持，从`/api/records/list`按`catId`与周期边界读取（g:\www-xxk\xcx-lababa\src\pages\ranking\index.vue:300-307）。

## 验证与兼容
- 统一使用`utils/request.ts`的鉴权与错误处理（默认会加`Authorization`）。
- 分页兼容：后端已兼容`pageNum/pageSize`，无需换算。
- 小程序/网页双端：输入与按钮已采用`env==='WEAPP'`分支写法，复用现有模式。

## 交付内容
- 更新三处页面代码以完成交互与接口对齐。
- 扩展后端排行榜接口以返回`nickname`与`catName`。
- 自测：
  - 切换不同猫，统计页各模块数据同步变化。
  - 个人页改昵称立即刷新，排行榜本人昵称同步。
  - 排行榜列表各项显示对应宠物名称。