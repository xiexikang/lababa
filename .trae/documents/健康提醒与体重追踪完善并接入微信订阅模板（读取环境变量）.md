## 环境变量
- WECHAT_APPID / WECHAT_SECRET：已存在，用于调用微信服务端接口。
- WEAPP_SUBSCRIBE_TEMPLATES：订阅模板 ID，逗号分隔（示例：tmpl_1,tmpl_2）。后端解析并下发到前端。

## 后端修复与扩展
- 修复并收拢体重与提醒代码到既有结构（openMySQL 内建表、main() 内路由），避免出现函数体外代码导致编译错误。
- 数据表：
  - cat_weights(id, catId, userId, weightKg, date, note, INDEX(catId,date))
  - cat_settings(catId[PK], userId, remindEnabled, remindNoRecord, remindDiarrhea, quietStart, quietEnd)
- 接口（鉴权 withAuth）：
  - GET /api/cats/weights/list?catId：返回体重记录
  - POST /api/cats/weights/create：新增体重（catId, weightKg, date?, note?）
  - GET /api/cats/settings/get?catId：读取提醒设置
  - PUT /api/cats/settings/update/{catId}：更新提醒设置（开关与静默时段）
  - GET /api/reminders/list：计算当前应提醒项（48h 未记录、24h 腹泻≥2），按 cat_settings 开关与静默时段过滤
  - GET /api/reminders/templates：读取环境变量 WEAPP_SUBSCRIBE_TEMPLATES，返回模板 ID 列表供前端订阅

## 前端（统计页）
- 体重趋势：
  - 新增区块“体重趋势”，简单柱形可视化（最近 10 条），显示日期与 kg 值。
  - “新增体重”弹窗，输入 kg 保存到 /api/cats/weights/create，并刷新趋势。
- 提醒设置：
  - 弹窗包含：总开关、48h 未记录开关、24h 腹泻开关（静默时段预留）。
  - 订阅按钮：调用后端 GET /api/reminders/templates 获取模板 ID 列表，前端 Taro.requestSubscribeMessage({ tmplIds }) 发起订阅；成功后保存设置到后端。
- 已有“按猫筛选”维持生效：所有统计与体重接口携带 catId。

## 微信订阅消息发送策略（占位）
- 服务端发送需使用 access_token + 模板数据结构；短期先完成订阅与提醒列表计算，发送可在后续阶段按正式模板字段对齐实现：
  - 预留 POST /api/reminders/send（仅调试用），依据 WECHAT_APPID/SECRET 获取 access_token，调用微信订阅消息发送接口。

## 验证
- 本地编译与运行后端，确保编译通过与接口联通。
- 前端统计页：
  - 切换猫后体重趋势/提醒设置可正常读取与保存。
  - 订阅模板调用成功路径与失败提示。
- 提醒列表：调用 /api/reminders/list，观察规则命中效果。

## 交付与配置
- 在后端 .env 增加 WEAPP_SUBSCRIBE_TEMPLATES，提供示例值即可。用户上线前将其替换为真实模板 ID。
- 代码内注释说明静默时段单位（分钟，00:00=0，23:59=1439）。

我将按以上计划先修复后端代码结构与路由，加入 /api/reminders/templates，并完善统计页体重趋势与提醒设置弹窗含“订阅”逻辑。请确认后开始实施。