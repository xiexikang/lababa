**统一鉴权方法**

* 在 `src/utils/request.ts` 增加 `ensureAuth(redirect?: string)`：

  * 读取 `auth-token`；存在返回 `true`

  * 不存在：采集当前路由 `path+query` 或使用传入 `redirect`；`navigateTo('/pages/login/index?redirect=...')` 并返回 `false`

* 保留已实现的 401/403 统一拦截（自动跳登录），`ensureAuth` 用于显式交互前的快速校验（如点击“邀请粑友”、打开详情）。

**登录页回跳**

* 已实现 `/pages/login/index`：登录完成后写入 `user-info` 与 `auth-token`，`eventCenter.trigger('user-updated')`；

* 回跳逻辑：

  * tabBar 页面：`switchTab({ url })`

  * 非 tabBar 页面：`redirectTo({ url })`（失败时回首页）

**页面 init() 与生命周期**

* 统一为四个页面新增 `init()` 并在 `onMounted` 与 `onShow` 调用：

  * 首页 `pages/index/index.vue`：

    * `init()`：预取邀请 `inviteId`（需鉴权）、解析并接受 `inviteId`（从当前路由参数）、刷新首页轻量数据（若有）；

    * 分享按钮点击前 `ensureAuth()`，否则禁用或提示登录。

  * 统计页 `pages/statistics/index.vue`：

    * `init()`：并发拉取个人周概览（含 `score/scoreDetails`）、月日历（`days/dayStatusMap`）、最近记录分页与摘要；

    * 评分区域：在评分条旁渲染 `scoreDetails`（便秘 −15、正常 +12、覆盖率 +6 等）。

  * 排行页 `pages/ranking/index.vue`：

    * `init(period)`：并发拉取公共榜单 `GET /api/ranking/list?period=...`（`requireAuth:false`）与个人数据 `GET /api/ranking/me?period=...`、`GET /api/user/me`；

    * period 切换仅调用 `init(period)` 不刷新整页；

    * 邀请与接受：按钮点击 `ensureAuth()` 后 `POST /api/friends/invite`；打开首页携带 `inviteId` 自动 `POST /api/friends/accept`。

  * 个人中心 `pages/profile/index.vue`：

    * `init()`：拉取个人摘要展示；未授权时卡片点击与按钮点击触发授权。

**接口契约与降级**

* `/api/friends/invite` 与 `/api/friends/accept`：需后端支持；前端保持调用并对失败做降级提示“邀请功能暂不可用”。

* 其他个人接口：统计周/月/最近、排行我的排名、user/me 已按 token 返回个人数据。

**测试与验收**

* 未登录访问或执行受保护操作 → 统一进入登录页 → 登录成功自动回到原页面并在 `onShow` 执行 `init()`；

* Tab 切换只调用该页 `init()`，不刷新全站；排行页除榜单外均为个人数据；统计页显示评分明细；H5/小程序一致。

