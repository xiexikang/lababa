**问题与目标**
- 1. `/api/friends/invite` 是否已存在：需要后端提供。若暂缺，前端可按约定接入并在缺失时降级。
- 2. 未登录统一跳转到独立登录页，登录成功后回到原页面。
- 3. 底部 Tab 切换时不刷新整个应用，而是调用“当前页面所需接口”，建议每个页面提供 `init()` 初始化方法，并在 `onMounted` 与 `onShow` 调用。

**后端接口约定（好友邀请）**
- `POST /api/friends/invite`（需鉴权）：返回 `{ inviteId: string }`；inviteId 与 inviterId 绑定，有效期/幂等由后端控制。
- `POST /api/friends/accept`（需鉴权）：入参 `{ inviteId }`，服务端解析出 inviterId，与当前用户建立粑友关系，幂等。
- 若当前后端未实现：
  - 前端保持调用；失败时 toast 提示“邀请功能暂不可用”。
  - 可临时隐藏/禁用分享入口，或仅分享文案不绑定关系。

**统一登录跳转**
- 新增登录页：`/pages/login/index`（前端已实现）
  - 登录流程：`Taro.login + Taro.getUserProfile → /api/auth/weapp`，写入 `auth-token` 与 `user-info`，广播 `user-updated`。
  - 回跳：读取 `redirect` 参数，tabBar 使用 `switchTab`，非 tabBar 使用 `redirectTo`。
- 请求层拦截（前端已接入）：
  - 401/403 时统一 `navigateTo('/pages/login/index?redirect=<current>')` 并 toast “请先登录”。
- 显式校验（可选）：在需要鉴权的交互前使用 `ensureAuth(redirect)`；其余依赖请求层。

**页面初始化 `init()` 方案**
- 每个页面（首页、统计、排行、个人中心）定义 `async init()`：
  - 封装该页面所有接口并发加载（`Promise.all`），只更新该页的响应式状态，不触发全局刷新。
  - 在 `onMounted` 首次调用，在 `onShow`（Tab 切换回到该页时）再次调用。
  - 遇到 401 → 请求层拦截到登录页；登录成功回跳后触发 `onShow` 自动再次调用 `init()`。
- 示例（Taro Vue3）：
  - `import { onMounted } from 'vue'; import Taro, { useDidShow as onShow } from '@tarojs/taro'` 或直接 `onShow` 可用。
  - `onMounted(() => init()); onShow(() => init());`

**排行页个人化**
- 公共榜单：`GET /api/ranking/list?period=total|day|week|month`（可 `requireAuth:false`）。
- 个人区块（头像昵称、我的排名、邀请/接受）：按个人接口查询；未登录由拦截/登录页处理。

**统计页评分明细**
- 接口返回 `score` 与 `scoreDetails: Array<{ label, value }>`；评分条保持阈值色；评分旁展示明细（便秘 −15、正常 +12、覆盖率 +6）。

**实施清单**
- 与后端确认/补充好友邀请与接受接口契约，前端保持调用并降级处理空接口。
- 统一登录页与请求层拦截已就绪；为各页面增加 `init()` 并在 `onMounted/onShow` 调用。
- 排行页改为：榜单公共接口，其余按个人接口；统计页评分展示明细。

**验证**
- 未登录访问或触发鉴权操作 → 进入登录页 → 登录成功自动回到原页面并触发 `init()`。
- Tab 切换时仅调用该页面 `init()` 并更新本页数据，不刷新全局。
- H5 与小程序一致。